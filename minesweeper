//–ù–ï–ß–ï–ì–û –ù–ï –£–î–ê–õ–Ø–¢–¨


using System;
using System.Drawing;
using System.Windows.Forms;

namespace Minesweeper
{
    public partial class MainForm : Form
    {
        private int rows = 9;
        private int cols = 9;
        private int minesCount = 10;
        private int flagsCount = 0;
        private Button[,] buttons;
        private bool[,] mines;
        private bool[,] opened;
        private bool[,] flags;
        private bool firstClick = true;
        private bool gameOver = false;

        private Label flagsLabel;
        private ToolStripMenuItem newGameToolStripMenuItem;
        private ToolStripMenuItem easyToolStripMenuItem;
        private ToolStripMenuItem mediumToolStripMenuItem;
        private ToolStripMenuItem hardToolStripMenuItem;
        private MenuStrip menuStrip1;
            
        public MainForm()
        {
            InitializeComponent();
            InitializeMenu();
            InitializeGame();
        }

        private void InitializeMenu()
        {
            menuStrip1 = new MenuStrip();
            this.Controls.Add(menuStrip1);

            newGameToolStripMenuItem = new ToolStripMenuItem("–ù–æ–≤–∞—è –∏–≥—Ä–∞");
            menuStrip1.Items.Add(newGameToolStripMenuItem);

            ToolStripMenuItem difficultyToolStripMenuItem = new ToolStripMenuItem("–°–ª–æ–∂–Ω–æ—Å—Ç—å");
            menuStrip1.Items.Add(difficultyToolStripMenuItem);

            easyToolStripMenuItem = new ToolStripMenuItem("–õ–µ–≥–∫–∞—è (9x9, 10 –º–∏–Ω)");
            mediumToolStripMenuItem = new ToolStripMenuItem("–°—Ä–µ–¥–Ω—è—è (16x16, 40 –º–∏–Ω)");
            hardToolStripMenuItem = new ToolStripMenuItem("–°–ª–æ–∂–Ω–∞—è (16x30, 99 –º–∏–Ω)");

            difficultyToolStripMenuItem.DropDownItems.Add(easyToolStripMenuItem);
            difficultyToolStripMenuItem.DropDownItems.Add(mediumToolStripMenuItem);
            difficultyToolStripMenuItem.DropDownItems.Add(hardToolStripMenuItem);

            easyToolStripMenuItem.Click += (s, e) => SetDifficulty(9, 9, 10);
            mediumToolStripMenuItem.Click += (s, e) => SetDifficulty(16, 16, 40);
            hardToolStripMenuItem.Click += (s, e) => SetDifficulty(16, 30, 99);
            newGameToolStripMenuItem.Click += (s, e) => InitializeGame();

            //—Å—á–µ—Ç—Å—á–∏–∫ —Ñ–ª–∞–∂–∫–æ–≤
            flagsLabel = new Label
            {
                Text = "–§–ª–∞–≥–∏: 0/" + minesCount,
                Font = new Font("Arial", 12),
                AutoSize = true,
                Location = new Point(10, 30)
            };
            this.Controls.Add(flagsLabel);
        }

        private void SetDifficulty(int rows, int cols, int minesCount)
        {
            this.rows = rows;
            this.cols = cols;
            this.minesCount = minesCount;
            InitializeGame();
        }

        private void InitializeGame()
        {
            
            if (buttons != null)
            {
                foreach (var button in buttons)
                {
                    this.Controls.Remove(button);
                }
            }

            //—Å–±—Ä–æ—Å –∏–≥—Ä—ã
            firstClick = true;
            gameOver = false;
            flagsCount = 0;
            flagsLabel.Text = "–§–ª–∞–≥–∏: 0/" + minesCount;

            
            this.ClientSize = new Size(cols * 30 + 20, rows * 30 + 70);

           
            buttons = new Button[rows, cols];
            mines = new bool[rows, cols];
            opened = new bool[rows, cols];
            flags = new bool[rows, cols];

            
            for (int i = 0; i < rows; i++)
            {
                for (int j = 0; j < cols; j++)
                {
                    buttons[i, j] = new Button
                    {
                        Width = 30,
                        Height = 30,
                        Location = new Point(j * 30 + 10, i * 30 + 60),
                        Tag = new Point(i, j),
                        Font = new Font("Arial", 10, FontStyle.Bold)
                    };

                    buttons[i, j].MouseUp += Button_MouseUp;
                    this.Controls.Add(buttons[i, j]);
                }
            }
        }

        private void Button_MouseUp(object sender, MouseEventArgs e)
        {
            if (gameOver) return;

            var button = (Button)sender;
            var position = (Point)button.Tag;
            int row = position.X;
            int col = position.Y;

            if (e.Button == MouseButtons.Right)
            {
                //—Ñ–ª–∞–∂–æ–∫
                if (!opened[row, col])
                {
                    flags[row, col] = !flags[row, col];
                    if (flags[row, col])
                    {
                        flagsCount++;
                        button.Text = "üö©";
                    }
                    else
                    {
                        flagsCount--;
                        button.Text = "";
                    }
                    flagsLabel.Text = "–§–ª–∞–≥–∏: " + flagsCount + "/" + minesCount;
                }
            }
            else if (e.Button == MouseButtons.Left && !flags[row, col])
            {
                if (firstClick)
                {
                    PlaceMines(row, col);
                    firstClick = false;
                }

                if (mines[row, col])
                {
                    //–∫–æ–Ω–µ—Ü –∏–≥—Ä—ã
                    button.BackColor = Color.Red;
                    RevealAllMines();
                    gameOver = true;
                    MessageBox.Show("–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏.");
                }
                else
                {
                    OpenCell(row, col);
                    if (CheckWin())
                    {
                        gameOver = true;
                        MessageBox.Show("–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –ø–æ–±–µ–¥–∏–ª–∏!");
                    }
                }
            }
        }

        private void PlaceMines(int safeRow, int safeCol)
        {
            Random random = new Random();
            int minesPlaced = 0;

            while (minesPlaced < minesCount)
            {
                int row = random.Next(rows);
                int col = random.Next(cols);

                // –º–∏–Ω—ã –Ω–µ—Ç –≤ —Å–≤–æ–±–æ–¥–Ω–æ–π —è—á–µ–π–∫–µ
                if ((row != safeRow || col != safeCol) && !mines[row, col])
                {
                    mines[row, col] = true;
                    minesPlaced++;
                }
            }
        }

        private void OpenCell(int row, int col)
        {
            if (row < 0 || row >= rows || col < 0 || col >= cols || opened[row, col] || flags[row, col])
                return;

            opened[row, col] = true;
            buttons[row, col].Enabled = false;

            int adjacentMines = CountAdjacentMines(row, col);

            if (adjacentMines > 0)
            {
                buttons[row, col].Text = adjacentMines.ToString();
                buttons[row, col].ForeColor = GetNumberColor(adjacentMines);
            }
            else
            {
                //–æ—Ç–∫—Ä—ã—Ç–∏–µ —è—á–µ–µ–∫
                for (int i = -1; i <= 1; i++)
                {
                    for (int j = -1; j <= 1; j++)
                    {
                        if (i != 0 || j != 0)
                        {
                            OpenCell(row + i, col + j);
                        }
                    }
                }
            }
        }

        private int CountAdjacentMines(int row, int col)
        {
            int count = 0;

            for (int i = -1; i <= 1; i++)
            {
                for (int j = -1; j <= 1; j++)
                {
                    if (i == 0 && j == 0) continue;

                    int newRow = row + i;
                    int newCol = col + j;

                    if (newRow >= 0 && newRow < rows && newCol >= 0 && newCol < cols && mines[newRow, newCol])
                    {
                        count++;
                    }
                }
            }

            return count;
        }

        private Color GetNumberColor(int number)
        {
            switch (number)
            {
                case 1: return Color.Blue;
                case 2: return Color.Green;
                case 3: return Color.Red;
                case 4: return Color.DarkBlue;
                case 5: return Color.Brown;
                case 6: return Color.Teal;
                case 7: return Color.Black;
                case 8: return Color.Gray;
                default: return Color.Black;
            }
        }

        private bool CheckWin()
        {
            for (int i = 0; i < rows; i++)
            {
                for (int j = 0; j < cols; j++)
                {
                    if (!mines[i, j] && !opened[i, j])
                    {
                        return false;
                    }
                }
            }
            return true;
        }

        private void RevealAllMines()
        {
            for (int i = 0; i < rows; i++)
            {
                for (int j = 0; j < cols; j++)
                {
                    if (mines[i, j])
                    {
                        buttons[i, j].Text = "üí£";
                        buttons[i, j].Enabled = false;
                    }
                }
            }
        }
    }
}



ltcbuyth 

namespace Minesweeper
{
    partial class MainForm
    {
        private System.ComponentModel.IContainer components = null;
        protected override void Dispose(bool disposing)
        {
            if (disposing && (components != null))
            {
                components.Dispose();
            }
            base.Dispose(disposing);
        }

        #region Windows Form Designer generated code
        private void InitializeComponent()
        {
            this.components = new System.ComponentModel.Container();
            this.AutoScaleMode = System.Windows.Forms.AutoScaleMode.Font;
            this.ClientSize = new System.Drawing.Size(300, 300);
            this.Text = "–°–∞–ø–µ—Ä";
        }

        #endregion
    }
}


using System;
using System.Windows.Forms;

namespace Minesweeper
{
    internal static class Program
    {
        [STAThread]
        static void Main()
        {
            Application.EnableVisualStyles();
            Application.SetCompatibleTextRenderingDefault(false);
            Application.Run(new MainForm());
        }
    }
}
